<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 ">
    <div>
      <h2 class="fw-bold mb-1">
        <i class="bx bx-list-ul"></i> Gestor de Formularios
      </h2>
      <p class="text-muted">Administra y crea formularios dinámicos para tu aplicación</p>
    </div>

    <button 
      class="btn btn-primary"
      (click)="openCreateModal()"
      [disabled]="(loading$ | async)">
      <i class="bx bx-plus"></i> Nuevo Formulario
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading$ | async" class="text-center my-5">
    <div class="spinner-border"></div>
    <p class="mt-2">Cargando formularios...</p>
  </div>

  <!-- Error Alert 
  <div *ngIf="error$ | async as error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bx bx-error-circle me-2"></i>
    <strong>Error:</strong> {{ error }}
    <button type="button" class="btn-close" (click)="closeError()"></button>
  </div>-->

  <!-- Empty State -->
  <div *ngIf="(forms$ | async) as forms">
    <div *ngIf="forms.length === 0 && !(loading$ | async)" class="text-center py-5">
      <i class="bx bx-inbox fs-1 text-muted"></i>
      <h4 class="mt-2">No hay formularios</h4>
      <p class="text-muted">Crea tu primer formulario para comenzar</p>
      <button class="btn btn-primary mt-2" (click)="openCreateModal()">
        <i class="bx bx-plus"></i> Crear Formulario
      </button>
    </div>

    <!-- Listado -->
    <div class="row g-4" *ngIf="forms.length > 0">
      <div class="col-md-6 col-lg-4" *ngFor="let form of forms">

        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0 fw-bold">{{ form.name }}</h5>
              <span class="badge bg-secondary">{{ form.code }}</span>
            </div>

            <p class="text-muted small">{{ form.description || 'Sin descripción' }}</p>

            <div class="mb-3 small">
              <div><strong>Versión:</strong> v{{ form.version }}</div>
              <div><strong>Creado por:</strong> ID {{ form.created_by }}</div>
              <div><strong>Orden:</strong> {{ form.display_order }}</div>
              <div>
                <strong>Estado:</strong>
                <span class="badge" [class.bg-success]="form.is_active" [class.bg-danger]="!form.is_active">
                  {{ form.is_active ? 'Activo' : 'Inactivo' }}
                </span>
              </div>
            </div>

            <div class="d-flex gap-2">
              <button class="btn btn-info btn-sm" (click)="viewFormDetails(form.id!)">
                <i class="bx bx-show"></i> Ver
              </button>
              <button class="btn btn-warning btn-sm" (click)="openEditModal(form)">
                <i class="bx bx-edit"></i> Editar
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteForm(form.id!)">
                <i class="bx bx-trash"></i> Eliminar
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


<!-- Modal Crear/Editar -->
<div class="modal fade show d-block" tabindex="-1" role="dialog" *ngIf="showFormModal" (click)="closeFormModal()">
  <div class="modal-dialog modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          <i [ngClass]="isEditMode ? 'bx bx-edit' : 'bx bx-plus-circle'"></i>
          {{ isEditMode ? 'Editar Formulario' : 'Crear Formulario' }}
        </h5>
        <button type="button" class="btn-close" (click)="closeFormModal()"></button>
      </div>

      <form (ngSubmit)="onSubmit()" #formForm="ngForm">
        <div class="modal-body row g-3">

          <div class="col-md-6">
            <label class="form-label">Nombre *</label>
            <input class="form-control" required [(ngModel)]="newForm.name" name="name">
          </div>

          <div class="col-md-6">
            <label class="form-label">Código *</label>
            <input class="form-control" required [(ngModel)]="newForm.code" name="code" [disabled]="isEditMode">
          </div>

          <div class="col-12">
            <label class="form-label">Descripción</label>
            <textarea class="form-control" rows="2" [(ngModel)]="newForm.description" name="description"></textarea>
          </div>

          <div class="col-md-6">
            <label class="form-label">Versión *</label>
            <input class="form-control" required [(ngModel)]="newForm.version" name="version">
          </div>

          <div class="col-md-6">
            <label class="form-label">Orden</label>
            <input type="number" class="form-control" [(ngModel)]="newForm.display_order" name="display_order">
          </div>

          <div class="form-check form-switch ms-3">
            <input class="form-check-input" type="checkbox" [(ngModel)]="newForm.is_active" name="is_active">
            <label class="form-check-label">Activo</label>
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeFormModal()">Cancelar</button>
          <button class="btn btn-primary" type="submit" [disabled]="!formForm.valid">
            {{ isEditMode ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>

    </div>
  </div>
</div>
